"use strict";var Circle=function(){function t(t){this.object=t}return t.prototype.draw=function(t){var e=this.object.position,i=this.object.radius;0<this.object.collisions.size?(t.strokeStyle="rgba(247, 186, 197, 0.8)",t.fillStyle="rgba(247, 186, 197, 0.6)"):(t.strokeStyle="rgba(255, 255, 255, 0.8)",t.fillStyle="rgba(255, 255, 255, 0.5)"),t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,i,0,2*Math.PI),t.closePath(),t.stroke(),t.fill()},t.prototype.print=function(){console.log("Circle{position: "+this.object.position+", radius: "+this.object.radius+"}")},t}(),Rectangle=function(){function t(t){this.object=t}return t.prototype.draw=function(t){var e=this.object.position,i=this.object.width,n=this.object.height;0<this.object.collisions.size?(t.strokeStyle="rgba(247, 186, 197, 0.8)",t.fillStyle="rgba(247, 186, 197, 0.6)"):(t.strokeStyle="rgba(255, 255, 255, 0.8)",t.fillStyle="rgba(255, 255, 255, 0.5)"),t.lineWidth=2,t.beginPath(),t.moveTo(e.x-i/2,e.y-n/2),t.lineTo(e.x+i/2,e.y-n/2),t.lineTo(e.x+i/2,e.y+n/2),t.lineTo(e.x-i/2,e.y+n/2),t.lineTo(e.x-i/2,e.y-n/2),t.closePath(),t.stroke(),t.fill()},t.prototype.print=function(){console.log("Rectangle{position: "+this.object.position+", width: "+this.object.width+", "+this.object.height+"}")},t}(),Renderer=function(){function t(t,e,i){this.canvas=t,this.renderables=[],this.width=e,this.height=i}return t.prototype.draw=function(){this.canvas.clearRect(0,0,this.width,this.height);var t=this.canvas.createLinearGradient(0,0,this.width,this.height);t.addColorStop(0,"#90C3D4"),t.addColorStop(1,"#82B0BF"),this.canvas.fillStyle=t,this.canvas.fillRect(0,0,this.width,this.height),this.draw_lines();for(var e=0,i=this.renderables;e<i.length;e++){i[e].draw(this.canvas)}},t.prototype.draw_lines=function(){this.canvas.lineWidth=.5;var t=100,e=this.width/t,i=this.height/t;this.canvas.strokeStyle="rgba(255, 255, 255, 0.3)";for(var n=0;n<i;n++)this.canvas.beginPath(),this.canvas.moveTo(0,n*t),this.canvas.lineTo(this.width,n*t),this.canvas.stroke();for(n=0;n<e;n++)this.canvas.beginPath(),this.canvas.moveTo(n*t,0),this.canvas.lineTo(n*t,this.height),this.canvas.stroke()},t.prototype.add=function(t){t instanceof NtRectangle?this.renderables.push(new Rectangle(t)):t instanceof NtCircle&&this.renderables.push(new Circle(t))},t.prototype.remove=function(e){var t=this.renderables.findIndex(function(t){return t.object==e});-1!=t&&this.renderables.splice(t,1)},t}(),NtAABB=function(){this.min=new NtVec,this.max=new NtVec},NtBase=function(){function e(t){this.position=new NtVec2,this.velocity=new NtVec2,this.collisions=new Set,this.aabb=new NtAABB,this.restitution=1,this.force=new NtVec2,this._mass=0,this._inverse_mass=0,this.position.fromVec(t),this.id=e.counter++}return e.prototype.step=function(t){this.position.add(NtVec2.multiply(this.velocity,t)),this.velocity.add(NtVec2.multiply(this.force,t/this.mass))},e.prototype.apply_impulse=function(t){this.velocity.add(NtVec2.multiply(t,this.inverse_mass))},Object.defineProperty(e.prototype,"mass",{get:function(){return this._mass},set:function(t){this._mass=t,this._inverse_mass=1/t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverse_mass",{get:function(){return this._inverse_mass},enumerable:!0,configurable:!0}),e.counter=0,e}(),__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),NtCircle=function(n){function t(t,e){var i=n.call(this,t)||this;return i.radius=e,i}return __extends(t,n),t.prototype.step=function(t){n.prototype.step.call(this,t),this.aabb.min.set(this.position.x-this.radius,this.position.y-this.radius),this.aabb.max.set(this.position.x+this.radius,this.position.y+this.radius)},t.prototype.toString=function(){return"NtCircle{position: "+this.position+", radius: "+this.radius+"}"},t}(NtBase),NtCollisionUtils=function(){function u(){}return u.AABBvsAABB=function(t){var e=t.A,i=t.B,n=NtVec.subtract(i.position,e.position),o=e.aabb,s=i.aabb,r=new NtVec,c=(o.max.x-o.min.x)/2,a=(s.max.x-s.min.x)/2;if(r.x=c+a-Math.abs(n.x),0<r.x){var l=(o.max.y-o.min.y)/2,h=(s.max.y-s.min.y)/2;if(r.y=l+h-Math.abs(n.y),0<r.y)return u.calculateNormal(t,r,n)}return!1},u.calculateNormal=function(t,e,i){return e.x>e.y?(i.x<0?t.normal=new NtVec(-1,0):t.normal=new NtVec(1,0),t.penetration=e.x):(i.y<0?t.normal=new NtVec(0,-1):t.normal=new NtVec(0,1),t.penetration=e.y),!0},u}(),NtManifold=function(){},NtRectangle=(__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),function(o){function t(t,e,i){var n=o.call(this,t)||this;return n.width=e,n.height=i,n}return __extends(t,o),t.prototype.step=function(t){o.prototype.step.call(this,t),this.aabb.min.set(this.position.x-this.width/2,this.position.y-this.height/2),this.aabb.max.set(this.position.x+this.width/2,this.position.y+this.height/2)},t.prototype.toString=function(){return"NtRectangle{position: "+this.position+", width: "+this.width+", height: "+this.height+"}"},t}(NtBase)),NtVec=function(){function i(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return i.prototype.add=function(t){this.x+=t.x,this.y+=t.y},i.prototype.subtract=function(t){this.x-=t.x,this.y-=t.y},i.prototype.fromVec=function(t){this.x=t.x,this.y=t.y},i.prototype.set=function(t,e){this.x=t,this.y=e},i.prototype.toString=function(){return"NtVec{x: "+this.x+", y: "+this.y+"}"},i.add=function(t,e){return new i(t.x+e.x,t.y+e.y)},i.subtract=function(t,e){return new i(t.x-e.x,t.y-e.y)},i.multiply=function(t,e){return new i(t.x*e,t.y*e)},i.dotProduct=function(t,e){return t.x*e.x+t.y*e.y},i}(),NtVec2=function(){function i(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.multiply=function(t){return this.x*=t,this.y*=t,this},i.prototype.divide=function(t){return this.x/=t,this.y/=t,this},i.prototype.fromVec=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.set=function(t,e){return this.x=t,this.y=e,this},i.prototype.toString=function(){return"NtVec2{x: "+this.x+", y: "+this.y+"}"},i.fromVec=function(t){return new i(t.x,t.y)},i.add=function(t,e){return new i(t.x+e.x,t.y+e.y)},i.subtract=function(t,e){return new i(t.x-e.x,t.y-e.y)},i.multiply=function(t,e){return new i(t.x*e,t.y*e)},i.divide=function(t,e){return new i(t.x/e,t.y/e)},i.dotProduct=function(t,e){return t.x*e.x+t.y*e.y},i.distance=function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},i.distanceSquared=function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n},i.equal=function(t,e){return t.x==e.x&&t.y==e.y},i.negate=function(t){return new i(-t.x,-t.y)},i}(),NtWorld=function(){function t(t){this.renderer=t,this.list=[],this.collisionResolver=new NtCollisionResolver}return t.prototype.step=function(e){var n=this;this.list.forEach(function(t){t.collisions.clear(),t.step(e)}),this.list.forEach(function(i){n.list.forEach(function(t){if(i!=t&&!i.collisions.has(t)){var e=new NtManifold(t,i);n.collisionResolver.hasCollision(e)&&(i.collisions.add(t),t.collisions.add(i),n.collisionResolver.resolve(e))}})})},t.prototype.add=function(t){this.list.push(t),this.renderer.add(t)},t.prototype.remove=function(t){var e=this.list.indexOf(t);-1!=e&&(this.list.splice(e,1),this.renderer.remove(t))},t}(),NtCollisionResolver=(NtAABB=function(){this.min=new NtVec2,this.max=new NtVec2},function(){function t(){}return t.prototype.hasCollision=function(t){var e=t.A,i=t.B;return e instanceof NtRectangle&&i instanceof NtRectangle?NtCollisionUtils.AABBvsAABB(t):e instanceof NtCircle&&i instanceof NtCircle?NtCollisionUtils.CircleVsCircle(t):e instanceof NtRectangle&&i instanceof NtCircle?NtCollisionUtils.AABBvsCircle(t):e instanceof NtCircle&&i instanceof NtRectangle&&(t.A=i,t.B=e,NtCollisionUtils.AABBvsCircle(t))},t.prototype.resolve=function(t){var e=t.A,i=t.B,n=NtVec2.subtract(i.velocity,e.velocity),o=t.normal,s=NtVec2.dotProduct(n,o),r=-(1+Math.min(e.restitution,i.restitution))*s;r/=e.inverse_mass+i.inverse_mass;var c=NtVec2.multiply(o,r);e.apply_impulse(NtVec2.negate(c)),i.apply_impulse(c)},t}()),phys1=(NtCollisionUtils=function(){function y(){}return y.AABBvsAABB=function(t){var e=t.A,i=t.B,n=NtVec2.subtract(i.position,e.position),o=e.aabb,s=i.aabb,r=new NtVec2,c=(o.max.x-o.min.x)/2,a=(s.max.x-s.min.x)/2;if(r.x=c+a-Math.abs(n.x),0<r.x){var l=(o.max.y-o.min.y)/2,h=(s.max.y-s.min.y)/2;if(r.y=l+h-Math.abs(n.y),0<r.y)return y.calculateNormal(t,r,n),!0}return!1},y.calculateNormal=function(t,e,i){e.x>e.y?(t.normal=new NtVec2(0,Math.sign(i.x)),t.penetration=e.x):(t.normal=new NtVec2(Math.sign(i.y),0),t.penetration=e.y)},y.CircleVsCircle=function(t){var e=t.A,i=t.B,n=NtVec2.subtract(i.position,e.position),o=e.radius+i.radius;if(o*=o,NtVec2.distanceSquared(e.position,i.position)>o)return!1;var s=NtVec2.distance(e.position,i.position);return 0!=s?(t.penetration=o-s,t.normal=NtVec2.divide(n,s)):(t.penetration=e.radius,t.normal=new NtVec2(1,0)),!0},y.AABBvsCircle=function(t){for(var e=t.A,i=t.B,n=e.aabb,o=[new NtVec2(n.min.x,n.min.y),new NtVec2(n.max.x,n.min.y),new NtVec2(n.min.x,n.max.y),new NtVec2(n.max.x,n.max.y),new NtVec2(n.min.x,n.min.y),new NtVec2(n.min.x,n.max.y),new NtVec2(n.max.x,n.min.y),new NtVec2(n.max.x,n.max.y)],s=new NtVec2(Number.MAX_VALUE,Number.MAX_VALUE),r=Number.MAX_VALUE,c=0;c<4;c++){var a=y.segmentProjection(i.position,o[2*c],o[2*c+1]),l=NtVec2.distanceSquared(a,i.position);l<r&&(s=a,r=l)}if(NtVec2.distanceSquared(s,i.position)>i.radius*i.radius)return!1;var h=NtVec2.distance(s,i.position),u=NtVec2.subtract(i.position,s).divide(h);return t.penetration=i.radius-h,t.normal=u,!0},y.segmentProjection=function(t,e,i){var n=NtVec2.distanceSquared(e,i);if(0==n)return NtVec2.fromVec(e);var o=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return o=Math.max(0,Math.min(1,o)),new NtVec2(e.x+o*(i.x-e.x),e.y+o*(i.y-e.y))},y}(),NtManifold=function(t,e){this.penetration=0,this.normal=new NtVec2,this.A=t,this.B=e},new NtRectangle(new NtVec2(370,160),50,40));phys1.mass=20,phys1.velocity.set(-1.5,0),console.log(phys1);var phys2=new NtRectangle(new NtVec2(10,160),50,40);phys2.mass=20,phys2.velocity.set(1.5,0),console.log(phys2);var phys3=new NtRectangle(new NtVec2(200,190),150,120);phys3.mass=20,console.log(phys3);var phys4=new NtRectangle(new NtVec2(210,-60),50,40);phys4.mass=20,phys4.velocity.set(0,1.5),console.log(phys4);var phys5=new NtRectangle(new NtVec2(210,370),50,40);phys5.mass=20,phys5.velocity.set(0,-1.5),console.log(phys5);var circle1=new NtCircle(new NtVec2(100,50),20);circle1.mass=20,circle1.velocity.set(.5,.5),console.log(circle1);var circle2=new NtCircle(new NtVec2(250,50),30);circle2.mass=30,circle2.velocity.set(-.5,.5),console.log(circle2);var circle3=new NtCircle(new NtVec2(150,150),40);circle3.mass=340,circle3.velocity.set(0,-1),console.log(circle3);var circle4=new NtCircle(new NtVec2(150,400),40);circle4.mass=20,circle4.force.set(0,-50),console.log(circle4);var rect1=new NtRectangle(new NtVec2(150,270),250,140);rect1.mass=4,rect1.force.set(3.5,0),console.log(rect1);var circle5=new NtCircle(new NtVec2(150,50),40);circle5.mass=20,circle5.force.set(0,80),console.log(circle5);var circle6=new NtCircle(new NtVec2(450,250),40);circle6.mass=20,circle6.velocity.set(-.8,0),circle6.apply_impulse(new NtVec2(-580,0)),console.log(circle6);var canvas=document.getElementById("myCanvas"),canvasContext=canvas.getContext("2d"),renderer=new Renderer(canvasContext,canvas.width,canvas.height),world=new NtWorld(renderer);world.add(circle4),world.add(circle5),world.add(circle6),world.add(rect1),setInterval(function(){world.step(.033),renderer.draw()},33);