"use strict";var Renderable=function(t){this.object=t},__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Circle=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.draw=function(t){var e=this.object.position,i=this.object.shape.radius;0<this.object.collisions.size?(t.strokeStyle="rgba(247, 186, 197, 0.8)",t.fillStyle="rgba(247, 186, 197, 0.6)"):(t.strokeStyle="rgba(255, 255, 255, 0.8)",t.fillStyle="rgba(255, 255, 255, 0.5)"),t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,i,0,2*Math.PI),t.closePath(),t.stroke(),t.fill()},t.prototype.print=function(){console.log("Circle{position: "+this.object.position+", shape: "+this.object.shape+"}")},t}(Renderable),Rectangle=(__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.draw=function(t){var e=this.object.position,i=this.object.shape;0<this.object.collisions.size?(t.strokeStyle="rgba(247, 186, 197, 0.8)",t.fillStyle="rgba(247, 186, 197, 0.6)"):(t.strokeStyle="rgba(255, 255, 255, 0.8)",t.fillStyle="rgba(255, 255, 255, 0.5)"),t.lineWidth=2,t.beginPath();var n=this.object.orientation,r=i.vertices,o=NtVec2.rotate(r[0],n);t.moveTo(e.x+o.x,e.y+o.y);for(var s=1;s<r.length;s++){var a=NtVec2.rotate(r[s],n);t.lineTo(e.x+a.x,e.y+a.y)}t.lineTo(e.x+o.x,e.y+o.y),t.closePath(),t.stroke(),t.fill()},t.prototype.print=function(){console.log("Rectangle{position: "+this.object.position+", width: "+this.object.shape+"}")},t}(Renderable)),Renderer=function(){function t(t,e,i){this.canvas=t,this.renderables=[],this.width=e,this.height=i}return t.prototype.draw=function(){this.canvas.clearRect(0,0,this.width,this.height);var t=this.canvas.createLinearGradient(0,0,this.width,this.height);t.addColorStop(0,"#90C3D4"),t.addColorStop(1,"#82B0BF"),this.canvas.fillStyle=t,this.canvas.fillRect(0,0,this.width,this.height),this.draw_lines();for(var e=0,i=this.renderables;e<i.length;e++){i[e].draw(this.canvas)}},t.prototype.draw_lines=function(){this.canvas.lineWidth=.5;var t=100,e=this.width/t,i=this.height/t;this.canvas.strokeStyle="rgba(255, 255, 255, 0.3)";for(var n=0;n<i;n++)this.canvas.beginPath(),this.canvas.moveTo(0,n*t),this.canvas.lineTo(this.width,n*t),this.canvas.stroke();for(n=0;n<e;n++)this.canvas.beginPath(),this.canvas.moveTo(n*t,0),this.canvas.lineTo(n*t,this.height),this.canvas.stroke()},t.prototype.add=function(t){t.shape instanceof NtRectangleShape?this.renderables.push(new Rectangle(t)):t.shape instanceof NtCircleShape&&this.renderables.push(new Circle(t))},t.prototype.remove=function(e){var t=this.renderables.findIndex(function(t){return t.object==e});-1!=t&&this.renderables.splice(t,1)},t}(),NtBody=function(){function t(t,e,i){void 0===i&&(i=new NtMaterial),this.collisions=new Set,this.aabb=new NtAABB,this.position=new NtVec2,this.velocity=new NtVec2,this.force=new NtVec2,this.layers=1,this.friction=1,this.angular_velocity=0,this.torque=0,this.orientation=0,this._mass=0,this._inverse_mass=0,this._inertia=1,this._inverse_inertia=1,this.position.fromVec(t),this.shape=e,this.material=i,this.calculate_mass()}return t.prototype.step=function(t){this.calculate_mass(),this.position.add(NtVec2.multiply(this.velocity,t)),this.velocity.add(NtVec2.multiply(this.force,t/this.mass)),this.angular_velocity+=this.torque*(t/this._inertia),this.orientation+=this.angular_velocity*t;var e=this.shape.get_bounds_for_orientation(this.orientation);this.aabb.min.setVec(NtVec2.add(this.position,e.min)),this.aabb.max.setVec(NtVec2.add(this.position,e.max))},t.prototype.calculate_mass=function(){this._mass=this.shape.area*this.material.density,0!=this._mass?this._inverse_mass=1/this._mass:this._inverse_mass=Number.MAX_VALUE},t.prototype.apply_impulse=function(t){this.velocity.add(NtVec2.multiply(t,this.inverse_mass))},Object.defineProperty(t.prototype,"mass",{get:function(){return this._mass},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inverse_mass",{get:function(){return this._inverse_mass},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inertia",{get:function(){return this._inertia},set:function(t){this._inertia=t,this._inverse_inertia=0!=t?1/t:Number.MAX_VALUE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inverse_inertia",{get:function(){return this._inverse_inertia},enumerable:!0,configurable:!0}),t}(),NtMaterial=function(t,e){void 0===t&&(t=.5),void 0===e&&(e=1),this.density=t,this.restitution=e},NtVec2=function(){function r(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return r.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},r.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},r.prototype.multiply=function(t){return this.x*=t,this.y*=t,this},r.prototype.divide=function(t){return this.x/=t,this.y/=t,this},r.prototype.fromVec=function(t){return this.x=t.x,this.y=t.y,this},r.prototype.set=function(t,e){return this.x=t,this.y=e,this},r.prototype.setVec=function(t){return this.x=t.x,this.y=t.y,this},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},r.prototype.normalize=function(){return this.divide(this.length())},r.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},r.prototype.toString=function(){return"NtVec2{x: "+this.x+", y: "+this.y+"}"},r.fromVec=function(t){return new r(t.x,t.y)},r.add=function(t,e){return new r(t.x+e.x,t.y+e.y)},r.subtract=function(t,e){return new r(t.x-e.x,t.y-e.y)},r.multiply=function(t,e){return new r(t.x*e,t.y*e)},r.divide=function(t,e){return new r(t.x/e,t.y/e)},r.dotProduct=function(t,e){return t.x*e.x+t.y*e.y},r.distance=function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},r.distanceSquared=function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n},r.equal=function(t,e){return t.x==e.x&&t.y==e.y},r.negate=function(t){return new r(-t.x,-t.y)},r.crossProduct=function(t,e){return t.x*e.y-t.y*e.x},r.crossProductScalarSecond=function(t,e){return new r(e*t.y,-e*t.x)},r.crossProductScalarFirst=function(t,e){return new r(-e*t.y,e*t.x)},r.rotate=function(t,e){var i=Math.cos(e),n=Math.sin(e);return new r(i*t.x-n*t.y,n*t.x+i*t.y)},r}(),NtWorld=function(){function t(t){this.renderer=t,this.list=[],this.collisionResolver=new NtCollisionResolver}return t.prototype.step=function(e){this.list.forEach(function(t){t.collisions.clear(),t.step(e)});for(var t=0;t<this.list.length-1;t++)for(var i=this.list[t],n=t+1;n<this.list.length;n++){var r=this.list[n];if(!(i.layers&r.layers)||i.collisions.has(r))return;if(this.collisionResolver.isCollisionLikely(r,i)){console.log("collision likely!");var o=new NtManifold(r,i);this.collisionResolver.hasCollision(o)&&(i.collisions.add(r),r.collisions.add(i),this.collisionResolver.resolve(o))}}},t.prototype.add=function(t){this.list.push(t),this.renderer.add(t)},t.prototype.remove=function(t){var e=this.list.indexOf(t);-1!=e&&(this.list.splice(e,1),this.renderer.remove(t))},t}(),NtShapeBase=function(){function t(){this._area=-1}return Object.defineProperty(t.prototype,"area",{get:function(){return-1==this._area&&(this._area=this.calculate_area()),this._area},enumerable:!0,configurable:!0}),t}(),NtBounds=function(t,e){this.min=new NtVec2,this.max=new NtVec2,this.min=t,this.max=e},NtCircleShape=(__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),function(i){function t(t){var e=i.call(this)||this;return e.radius=t,e}return __extends(t,i),t.prototype.get_bounds_for_orientation=function(){return new NtBounds(new NtVec2(-this.radius,-this.radius),new NtVec2(this.radius,this.radius))},t.prototype.calculate_area=function(){return Math.PI*this.radius*this.radius},t.prototype.toString=function(){return"NtCircleShape{radius: "+this.radius+"}"},t}(NtShapeBase)),NtPolygonShape=(__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),function(i){function t(t){var e=i.call(this)||this;return e.normals=[],e.vertices=t,e.calculate_surface_normals(),e}return __extends(t,i),t.prototype.get_bounds_for_orientation=function(t){for(var e=new NtBounds(new NtVec2(Number.MAX_VALUE,Number.MAX_VALUE),new NtVec2(-Number.MAX_VALUE,-Number.MAX_VALUE)),i=0;i<this.vertices.length;i++){var n=NtVec2.rotate(this.vertices[i],t);e.min.x>n.x&&(e.min.x=n.x),e.min.y>n.y&&(e.min.y=n.y),e.max.x<n.x&&(e.max.x=n.x),e.max.y<n.y&&(e.max.y=n.y)}return e},t.prototype.calculate_surface_normals=function(){for(var t=0;t<this.vertices.length;t++){var e=this.vertices[t],i=this.vertices[(t+1)%this.vertices.length],n=i.x-e.x,r=i.y-e.y,o=new NtVec2(n,r),s=new NtVec2(-r,n).normalize();NtVec2.crossProduct(o,s)<0?this.normals.push(s):this.normals.push(s.negate())}},t.prototype.get_support_point=function(i){var n=-Number.MAX_VALUE,r=this.vertices[0];return this.vertices.forEach(function(t){var e=NtVec2.dotProduct(t,i);n<e&&(r=t,n=e)}),r},t}(NtShapeBase)),NtRectangleShape=(__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),function(n){function t(t,e){var i=n.call(this,[new NtVec2(-t/2,-e/2),new NtVec2(t/2,-e/2),new NtVec2(t/2,e/2),new NtVec2(-t/2,e/2)])||this;return i.width=t,i.height=e,i}return __extends(t,n),t.prototype.calculate_area=function(){return this.width*this.height},t.prototype.toString=function(){return"NtRectangleShape{width: "+this.width+", height: "+this.height+"}"},t}(NtPolygonShape)),NtAABB=function(){this.min=new NtVec2,this.max=new NtVec2},NtCollisionResolver=function(){function t(){}return t.prototype.isCollisionLikely=function(t,e){var i=t.shape,n=e.shape;return i instanceof NtPolygonShape&&n instanceof NtCircleShape?NtCollisionUtils.AABBvsCircle(t,e):i instanceof NtCircleShape&&n instanceof NtPolygonShape?NtCollisionUtils.AABBvsCircle(e,t):NtCollisionUtils.AABBvsAABB(t,e)},t.prototype.hasCollision=function(t){var e=t.A,i=t.B,n=e.shape,r=i.shape;return n instanceof NtPolygonShape&&r instanceof NtPolygonShape?NtCollisionUtils.polygonVsPolygon(t):n instanceof NtCircleShape&&r instanceof NtCircleShape&&NtCollisionUtils.CircleVsCircle(t)},t.prototype.resolve=function(t){var e=t.A,i=t.B,n=NtVec2.subtract(i.velocity,e.velocity),r=t.normal,o=NtVec2.dotProduct(n,r);if(!(0<o)){var s=-(1+Math.min(e.material.restitution,i.material.restitution))*o;s/=e.inverse_mass+i.inverse_mass;var a=NtVec2.multiply(r,s);e.apply_impulse(NtVec2.negate(a)),i.apply_impulse(a),n=NtVec2.subtract(i.velocity,e.velocity);var c=NtVec2.subtract(n,NtVec2.multiply(r,o));c.normalize();var l=-NtVec2.dotProduct(n,c);l/=e.inverse_mass+i.inverse_mass;var h=(e.friction+i.friction)/2,u=new NtVec2;Math.abs(l)<s*h?u.setVec(NtVec2.multiply(c,l)):u.setVec(NtVec2.multiply(c,-s*h)),e.velocity.subtract(NtVec2.multiply(u,e.inverse_mass)),i.velocity.add(NtVec2.multiply(u,i.inverse_mass))}},t}(),NtCollisionUtils=function(){function l(){}return l.AABBvsAABB=function(t,e){var i=NtVec2.subtract(e.position,t.position),n=t.aabb,r=e.aabb,o=new NtVec2,s=(n.max.x-n.min.x)/2,a=(r.max.x-r.min.x)/2;if(o.x=s+a-Math.abs(i.x),0<o.x){var c=(n.max.y-n.min.y)/2,l=(r.max.y-r.min.y)/2;if(o.y=c+l-Math.abs(i.y),0<o.y)return!0}return!1},l.CircleVsCircle=function(t){var e=t.A,i=t.B,n=e.shape,r=i.shape,o=NtVec2.subtract(i.position,e.position),s=n.radius+r.radius;if(s*=s,NtVec2.distanceSquared(e.position,i.position)>s)return!1;var a=NtVec2.distance(e.position,i.position);return 0!=a?(t.penetration=s-a,t.normal=NtVec2.divide(o,a)):(t.penetration=n.radius,t.normal=new NtVec2(1,0)),!0},l.AABBvsCircle=function(t,e){for(var i=e.shape,n=t.aabb,r=[new NtVec2(n.min.x,n.min.y),new NtVec2(n.max.x,n.min.y),new NtVec2(n.min.x,n.max.y),new NtVec2(n.max.x,n.max.y),new NtVec2(n.min.x,n.min.y),new NtVec2(n.min.x,n.max.y),new NtVec2(n.max.x,n.min.y),new NtVec2(n.max.x,n.max.y)],o=Number.MAX_VALUE,s=0;s<4;s++){var a=l.segmentProjection(e.position,r[2*s],r[2*s+1]),c=NtVec2.distanceSquared(a,e.position);c<o&&(o=c)}return!(o>i.radius*i.radius)},l.segmentProjection=function(t,e,i){var n=NtVec2.distanceSquared(e,i);if(0==n)return NtVec2.fromVec(e);var r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return r=Math.max(0,Math.min(1,r)),new NtVec2(e.x+r*(i.x-e.x),e.y+r*(i.y-e.y))},l.polygonVsPolygon=function(t){var e=this.axisLeastPenetration(t.A,t.B),i=e[0],n=e[1];if(i<0)return!1;t.penetration=i;var r=t.A.shape;return t.normal=NtVec2.rotate(r.normals[n],t.A.orientation),!0},l.axisLeastPenetration=function(t,e){for(var i=-Number.MAX_VALUE,n=-1,r=t.shape,o=e.shape,s=0;s<r.vertices.length;s++){var a=NtVec2.rotate(r.normals[s],t.orientation),c=NtVec2.rotate(a,e.orientation),l=o.get_support_point(c.negate()),h=NtVec2.add(e.position,NtVec2.rotate(l,-e.orientation)),u=NtVec2.add(t.position,NtVec2.rotate(r.vertices[s],t.orientation)),p=NtVec2.dotProduct(a,NtVec2.subtract(h,u));i<p&&(i=p,n=s)}return[-i,n]},l}(),NtManifold=function(t,e){this.penetration=0,this.normal=new NtVec2,this.A=t,this.B=e},circle4=new NtBody(new NtVec2(150,340),new NtRectangleShape(40,40));circle4.material.density=.002,circle4.force.set(150,-100),circle4.orientation=-Math.PI/4,console.log(circle4);var circle7=new NtBody(new NtVec2(450,400),new NtCircleShape(40));circle7.material.density=.002,circle7.force.set(0,-350),console.log(circle7);var rect1=new NtBody(new NtVec2(280,170),new NtRectangleShape(350,140));rect1.material.density=10,rect1.friction=.6,rect1.orientation=-Math.PI/8,console.log(rect1);var circle5=new NtBody(new NtVec2(150,50),new NtCircleShape(40));circle5.material.density=.002,circle5.force.set(0,80),console.log(circle5);var circle6=new NtBody(new NtVec2(450,250),new NtCircleShape(40));circle6.material.density=.002,circle6.force.setVec(new NtVec2(-80,0)),console.log(circle6);var canvas=document.getElementById("myCanvas"),canvasContext=canvas.getContext("2d"),renderer=new Renderer(canvasContext,canvas.width,canvas.height),world=new NtWorld(renderer);world.add(circle4),world.add(rect1),setInterval(function(){world.step(.033),renderer.draw()},33);