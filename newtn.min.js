"use strict";var Renderable=function(t){this.object=t},__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Circle=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.draw=function(t){var e=this.object.position,i=this.object.shape.radius;0<this.object.collisions.size?(t.strokeStyle="rgba(247, 186, 197, 0.8)",t.fillStyle="rgba(247, 186, 197, 0.6)"):(t.strokeStyle="rgba(255, 255, 255, 0.8)",t.fillStyle="rgba(255, 255, 255, 0.5)"),t.lineWidth=2,t.beginPath(),t.arc(e.x,e.y,i,0,2*Math.PI),t.closePath(),t.stroke(),t.fill()},t.prototype.print=function(){console.log("Circle{position: "+this.object.position+", shape: "+this.object.shape+"}")},t}(Renderable),Rectangle=(__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.draw=function(t){var e=this.object.position,i=this.object.shape;0<this.object.collisions.size?(t.strokeStyle="rgba(247, 186, 197, 0.8)",t.fillStyle="rgba(247, 186, 197, 0.6)"):(t.strokeStyle="rgba(255, 255, 255, 0.8)",t.fillStyle="rgba(255, 255, 255, 0.5)"),t.lineWidth=2,t.beginPath();var n=this.object.orientation,o=i.vertices,r=NtVec2.rotate(o[0],n);t.moveTo(e.x+r.x,e.y+r.y);for(var s=1;s<o.length;s++){var a=NtVec2.rotate(o[s],n);t.lineTo(e.x+a.x,e.y+a.y)}t.lineTo(e.x+r.x,e.y+r.y),t.closePath(),t.stroke(),t.fill()},t.prototype.print=function(){console.log("Rectangle{position: "+this.object.position+", width: "+this.object.shape+"}")},t}(Renderable)),Renderer=function(){function t(t,e,i){this.canvas=t,this.renderables=[],this.width=e,this.height=i}return t.prototype.draw=function(){var t=this.canvas.createLinearGradient(0,0,this.width,this.height);t.addColorStop(0,"#90C3D4"),t.addColorStop(1,"#82B0BF"),this.canvas.fillStyle=t,this.canvas.fillRect(0,0,this.width,this.height),this.draw_lines();for(var e=0,i=this.renderables;e<i.length;e++){i[e].draw(this.canvas)}},t.prototype.draw_lines=function(){this.canvas.lineWidth=.5;var t=100,e=this.width/t,i=this.height/t;this.canvas.strokeStyle="rgba(255, 255, 255, 0.3)";for(var n=0;n<i;n++)this.canvas.beginPath(),this.canvas.moveTo(0,n*t),this.canvas.lineTo(this.width,n*t),this.canvas.stroke();for(n=0;n<e;n++)this.canvas.beginPath(),this.canvas.moveTo(n*t,0),this.canvas.lineTo(n*t,this.height),this.canvas.stroke()},t.prototype.add=function(t){t.shape instanceof NtRectangleShape?this.renderables.push(new Rectangle(t)):t.shape instanceof NtCircleShape&&this.renderables.push(new Circle(t))},t.prototype.remove=function(e){var t=this.renderables.findIndex(function(t){return t.object==e});-1!=t&&this.renderables.splice(t,1)},t}(),NtBody=function(){function t(t,e,i){void 0===i&&(i=new NtMaterial),this.collisions=new Set,this.aabb=new NtAABB,this.position=new NtVec2,this.velocity=new NtVec2,this.force=new NtVec2,this.gravity=new NtVec2,this.layers=1,this.friction=1,this.angular_velocity=0,this.torque=0,this.orientation=0,this.raycaster=null,this._mass=0,this._inverse_mass=0,this._inertia=1,this._inverse_inertia=1,this._is_static=!1,this.resolver=new NtCollisionResolver,this.position.fromVec(t),this.shape=e,this.material=i,this.calculate_mass()}return t.prototype.step=function(t){if(!this._is_static){this.calculate_mass();var e=NtVec2.multiply(this.gravity,this._mass),i=NtVec2.add(this.force,e);this.velocity.add(NtVec2.multiply(i,this._inverse_mass*t)),this.angular_velocity+=this.torque*this._inverse_inertia*t;var n=NtVec2.multiply(this.velocity,t).add(this.position),o=new NtRaycastManifold;if(this.raycaster&&this.raycaster.raycast(this,this.position,n,o)){this.position.setVec(o.intersection_global).add(NtVec2.normalize(this.velocity).negate().multiply(2));var r=new NtManifold(this,o.other_body);this.resolver.hasCollision(r),this.resolver.resolve(r)}else this.position.setVec(n);this.orientation+=this.angular_velocity*t}var s=this.shape.get_bounds_for_orientation(this.orientation);this.aabb.min.setVec(NtVec2.add(this.position,s.min)),this.aabb.max.setVec(NtVec2.add(this.position,s.max))},t.prototype.apply_impulse=function(t,e){this.velocity.add(NtVec2.multiply(t,this.inverse_mass)),this.angular_velocity+=NtVec2.crossProduct(e,t)*this.inverse_inertia},t.prototype.make_static=function(){this.velocity.set(0,0),this.angular_velocity=0,this.force.set(0,0),this.gravity.set(0,0),this.material.density=Number.MAX_VALUE,this.calculate_mass(),this._is_static=!0},t.prototype.is_point_in_body=function(t){return this.shape.is_point_in_shape(t)},t.prototype.calculate_mass=function(){this.material.density==Number.MAX_VALUE?(this._mass=Number.MAX_VALUE,this._inverse_mass=0):0==this.material.density?(this._mass=0,this._inverse_mass=Number.MAX_VALUE):(this._mass=this.shape.area*this.material.density,this._inverse_mass=0!=this._mass?1/this._mass:Number.MAX_VALUE),this._inertia=this.shape.get_moment_of_inertia(this.material.density),this._inverse_inertia=0!=this._inertia?1/this._inertia:0},Object.defineProperty(t.prototype,"mass",{get:function(){return this._mass},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inverse_mass",{get:function(){return this._inverse_mass},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inertia",{get:function(){return this._inertia},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inverse_inertia",{get:function(){return this._inverse_inertia},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"is_static",{get:function(){return this._is_static},enumerable:!0,configurable:!0}),t}(),NtMaterial=function(t,e){void 0===t&&(t=.5),void 0===e&&(e=1),this.density=t,this.restitution=e},NtVec2=function(){function o(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return o.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},o.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},o.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},o.prototype.multiply=function(t){return this.x*=t,this.y*=t,this},o.prototype.divide=function(t){return this.x/=t,this.y/=t,this},o.prototype.fromVec=function(t){return this.x=t.x,this.y=t.y,this},o.prototype.set=function(t,e){return this.x=t,this.y=e,this},o.prototype.setVec=function(t){return this.x=t.x,this.y=t.y,this},o.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},o.prototype.normalize=function(){return this.divide(this.length())},o.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},o.prototype.toString=function(){return"NtVec2{x: "+this.x+", y: "+this.y+"}"},o.fromVec=function(t){return new o(t.x,t.y)},o.add=function(t,e){return new o(t.x+e.x,t.y+e.y)},o.subtract=function(t,e){return new o(t.x-e.x,t.y-e.y)},o.multiply=function(t,e){return new o(t.x*e,t.y*e)},o.divide=function(t,e){return new o(t.x/e,t.y/e)},o.dotProduct=function(t,e){return t.x*e.x+t.y*e.y},o.distance=function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},o.distanceSquared=function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n},o.equal=function(t,e){return t.x==e.x&&t.y==e.y},o.negate=function(t){return new o(-t.x,-t.y)},o.crossProduct=function(t,e){return t.x*e.y-t.y*e.x},o.crossProductScalarSecond=function(t,e){return new o(e*t.y,-e*t.x)},o.crossProductScalarFirst=function(t,e){return new o(-e*t.y,e*t.x)},o.rotate=function(t,e){var i=Math.cos(e),n=Math.sin(e);return new o(i*t.x-n*t.y,n*t.x+i*t.y)},o.normalize=function(t){return(new o).setVec(t).normalize()},o}(),NtWorld=function(){function t(t){this.list=[],this.joints=[],this.collision_resolver=new NtCollisionResolver,this.gravity=new NtVec2,this.renderer=t,this.raycaster=new NtRaycaster(this)}return t.prototype.step=function(e){var i=this;this.list.forEach(function(t){t.collisions.clear(),t.gravity.setVec(i.gravity),t.raycaster=i.raycaster,t.step(e)}),this.joints.forEach(function(t){t.resolve()});for(var t=0;t<this.list.length-1;t++)for(var n=this.list[t],o=t+1;o<this.list.length;o++){var r=this.list[o];if(!(n.layers&r.layers)||n.collisions.has(r))return;if(this.collision_resolver.isCollisionLikely(r,n)){var s=new NtManifold(r,n);this.collision_resolver.hasCollision(s)&&(n.collisions.add(r),r.collisions.add(n),this.collision_resolver.resolve(s))}}},t.prototype.add=function(t){this.list.push(t),this.renderer.add(t)},t.prototype.remove=function(t){var e=this.list.indexOf(t);-1!=e&&(this.list.splice(e,1),this.renderer.remove(t))},t.prototype.addJoint=function(t){this.joints.push(t)},t.prototype.body_under_point=function(t){for(var e=0,i=this.list;e<i.length;e++){var n=i[e],o=NtVec2.rotate(NtVec2.subtract(t,n.position),-n.orientation);if(n.is_point_in_body(o))return n}return null},t}(),NtShapeBase=function(){function t(){this._area=-1}return Object.defineProperty(t.prototype,"area",{get:function(){return-1==this._area&&(this._area=this.calculate_area()),this._area},enumerable:!0,configurable:!0}),t}(),NtBounds=function(t,e){this.min=new NtVec2,this.max=new NtVec2,this.min=t,this.max=e},NtCircleShape=(__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),function(i){function t(t){var e=i.call(this)||this;return e.radius=t,e}return __extends(t,i),t.prototype.get_bounds_for_orientation=function(){return new NtBounds(new NtVec2(-this.radius,-this.radius),new NtVec2(this.radius,this.radius))},t.prototype.calculate_area=function(){return Math.PI*this.radius*this.radius},t.prototype.get_moment_of_inertia=function(t){return t*Math.PI*Math.pow(this.radius,4)},t.prototype.is_point_in_shape=function(t){return t.x*t.x+t.y*t.y<this.radius*this.radius},t.prototype.intersection_with_segment=function(t,e){var i=new NtVec2(0,0),n=this.radius,o=NtVec2.subtract(e,t),r=NtVec2.subtract(t,i),s=NtVec2.dotProduct(o,o),a=2*NtVec2.dotProduct(r,o),c=a*a-4*s*(NtVec2.dotProduct(r,r)-n*n);if(c<0)return null;var l=Math.sqrt(c),h=(-a-l)/(2*s),u=(-a+l)/(2*s);return 0<=h&&h<=1?NtVec2.multiply(o,h).add(t):0<=u&&u<=1?NtVec2.multiply(o,u).add(t):null},t.prototype.toString=function(){return"NtCircleShape{radius: "+this.radius+"}"},t}(NtShapeBase)),NtPolygonShape=(__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),function(i){function t(t){var e=i.call(this)||this;return e.normals=[],e.vertices=t,e.calculate_surface_normals(),e}return __extends(t,i),t.prototype.get_bounds_for_orientation=function(t){for(var e=new NtBounds(new NtVec2(Number.MAX_VALUE,Number.MAX_VALUE),new NtVec2(-Number.MAX_VALUE,-Number.MAX_VALUE)),i=0;i<this.vertices.length;i++){var n=NtVec2.rotate(this.vertices[i],t);e.min.x>n.x&&(e.min.x=n.x),e.min.y>n.y&&(e.min.y=n.y),e.max.x<n.x&&(e.max.x=n.x),e.max.y<n.y&&(e.max.y=n.y)}return e},t.prototype.calculate_surface_normals=function(){for(var t=0;t<this.vertices.length;t++){var e=this.vertices[t],i=this.vertices[(t+1)%this.vertices.length],n=i.x-e.x,o=i.y-e.y,r=new NtVec2(n,o),s=new NtVec2(-o,n).normalize();NtVec2.crossProduct(r,s)<0?this.normals.push(s):this.normals.push(s.negate())}},t.prototype.get_support_point=function(i){var n=-Number.MAX_VALUE,o=this.vertices[0];return this.vertices.forEach(function(t){var e=NtVec2.dotProduct(t,i);n<e&&(o=t,n=e)}),o},t.prototype.get_moment_of_inertia=function(t){for(var e=0,i=0;i<this.vertices.length;i++){var n=this.vertices[i],o=this.vertices[(i+1)%this.vertices.length];e+=.25*NtVec2.crossProduct(n,o)/3*(n.x*n.x+o.x*n.x+o.x*o.x+(n.y*n.y+o.y*n.y+o.y*o.y))}return e*=t},t.prototype.is_point_in_shape=function(t){for(var e=0,i=0;i<this.vertices.length;i++){var n=this.vertices[i],o=this.vertices[(i+1)%this.vertices.length],r=this.cross_product(n,t,o);if(0!=r)if(0==e)e=Math.sign(r);else if(Math.sign(r)!=e)return!1}return!0},t.prototype.cross_product=function(t,e,i){return NtVec2.crossProduct(NtVec2.subtract(e,t),NtVec2.subtract(i,t))},t.prototype.intersection_with_segment=function(t,e){for(var i=0;i<this.vertices.length;i++){var n=this.vertices[i],o=this.vertices[(i+1)%this.vertices.length],r=this.segment_intersection(t,e,n,o);if(r)return r}return null},t.prototype.segment_intersection=function(t,e,i,n){var o=t,r=NtVec2.subtract(e,t),s=i,a=NtVec2.subtract(n,i),c=NtVec2.subtract(s,o),l=NtVec2.crossProduct(r,a),h=NtVec2.crossProduct(c,r),u=NtVec2.crossProduct(c,a)/l,p=h/l;return 0!=h&&0==l?null:0!=l&&0<=u&&u<=1&&0<=p&&p<=1?NtVec2.multiply(r,u).add(o):null},t}(NtShapeBase)),NtRectangleShape=(__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),function(n){function t(t,e){var i=n.call(this,[new NtVec2(-t/2,-e/2),new NtVec2(t/2,-e/2),new NtVec2(t/2,e/2),new NtVec2(-t/2,e/2)])||this;return i.width=t,i.height=e,i}return __extends(t,n),t.prototype.calculate_area=function(){return this.width*this.height},t.prototype.toString=function(){return"NtRectangleShape{width: "+this.width+", height: "+this.height+"}"},t}(NtPolygonShape)),NtAABB=function(){this.min=new NtVec2,this.max=new NtVec2},NtCollisionResolver=function(){function t(){}return t.prototype.isCollisionLikely=function(t,e){return NtCollisionUtils.AABBvsAABB(t,e)},t.prototype.hasCollision=function(t){var e=t.A,i=t.B,n=e.shape,o=i.shape;return n instanceof NtPolygonShape&&o instanceof NtPolygonShape?new NtPolygonPolygonCollision(t).hasCollision():n instanceof NtCircleShape&&o instanceof NtCircleShape?new NtCircleCircleCollision(t).hasCollision():n instanceof NtCircleShape&&o instanceof NtPolygonShape?new NtCirclePolygonCollision(t).hasCollision():n instanceof NtPolygonShape&&o instanceof NtCircleShape&&(t.A=i,t.B=e,new NtCirclePolygonCollision(t).hasCollision())},t.prototype.resolve=function(t){for(var e=t.A,i=t.B,n=t.normal,o=[],r=[],s=0;s<t.contact_points.length;s++){var a=t.contact_points[s],c=NtVec2.subtract(a,e.position),l=NtVec2.subtract(a,i.position),h=NtVec2.subtract(i.velocity,e.velocity).add(NtVec2.crossProductScalarFirst(l,i.angular_velocity)).subtract(NtVec2.crossProductScalarFirst(c,e.angular_velocity)),u=NtVec2.dotProduct(h,n),p=NtVec2.crossProduct(c,n),d=NtVec2.crossProduct(l,n),_={contact_point:a,ra:c,rb:l,ra_length:p,rb_length:d,denominator:e.inverse_mass+i.inverse_mass+p*p*e.inverse_inertia+d*d*i.inverse_inertia,relative_vel:h,velocity_along_normal:u,a_impulses:o,b_impulses:r};if(0<u)return;this.apply_impulse(t,_),this.apply_friction(t,_)}for(var f=0,y=o;f<y.length;f++){var v=y[f];e.apply_impulse(v[0],v[1])}for(var m=0,N=r;m<N.length;m++){v=N[m];i.apply_impulse(v[0],v[1])}this.prevent_sinking(t)},t.prototype.prevent_sinking=function(t){var e=t.A,i=t.B,n=e.inverse_mass+i.inverse_mass,o=.6*Math.max(t.penetration-.06,0)/n,r=NtVec2.multiply(t.normal,o);e.position.subtract(NtVec2.multiply(r,e.inverse_mass)),i.position.add(NtVec2.multiply(r,i.inverse_mass))},t.prototype.apply_impulse=function(t,e){var i=t.A,n=t.B,o=e.ra,r=e.rb,s=this.get_impulse(t,e);e.a_impulses.push([NtVec2.negate(s),NtVec2.rotate(o,-i.orientation)]),e.b_impulses.push([s,NtVec2.rotate(r,-n.orientation)])},t.prototype.get_impulse=function(t,e){var i=this.calculate_j(t,e);return NtVec2.multiply(t.normal,i)},t.prototype.calculate_j=function(t,e){var i=-(1+Math.min(t.A.material.restitution,t.B.material.restitution))*e.velocity_along_normal;return i/=e.denominator,i/=t.contact_points.length,e.j=i},t.prototype.apply_friction=function(t,e){var i=t.A,n=t.B,o=e.ra,r=e.rb,s=NtVec2.subtract(n.velocity,i.velocity).add(NtVec2.crossProductScalarFirst(r,n.angular_velocity)).subtract(NtVec2.crossProductScalarFirst(o,i.angular_velocity)),a=t.normal,c=NtVec2.subtract(s,NtVec2.multiply(a,NtVec2.dotProduct(s,a)));0==c.x&&0==c.y?c.set(1,0):c.normalize(),e.tangent=c;var l=this.get_friction_impulse(t,e);e.a_impulses.push([NtVec2.negate(l),o]),e.b_impulses.push([l,r])},t.prototype.calculate_jt=function(t,e){var i=-NtVec2.dotProduct(e.relative_vel,e.tangent);return i/=e.denominator,i/=t.contact_points.length},t.prototype.get_friction_impulse=function(t,e){var i=(t.A.friction+t.B.friction)/2,n=new NtVec2,o=this.calculate_jt(t,e);return Math.abs(o)<e.j*i?n.setVec(NtVec2.multiply(e.tangent,o)):n.setVec(NtVec2.multiply(e.tangent,-e.j*i)),n},t}(),NtCollisionUtils=function(){function t(){}return t.AABBvsAABB=function(t,e){var i=NtVec2.subtract(e.position,t.position),n=t.aabb,o=e.aabb,r=new NtVec2,s=(n.max.x-n.min.x)/2,a=(o.max.x-o.min.x)/2;if(r.x=s+a-Math.abs(i.x),0<r.x){var c=(n.max.y-n.min.y)/2,l=(o.max.y-o.min.y)/2;if(r.y=c+l-Math.abs(i.y),0<r.y)return!0}return!1},t}(),NtManifold=function(t,e){this.penetration=0,this.normal=new NtVec2,this.contact_points=[],this.A=t,this.B=e},NtRaycaster=function(){function t(t){this.world=t}return t.prototype.raycast=function(t,e,i,n){for(var o=0,r=this.world.list;o<r.length;o++){var s=r[o];if(t!=s){var a=NtVec2.rotate(NtVec2.subtract(e,s.position),-s.orientation),c=NtVec2.rotate(NtVec2.subtract(i,s.position),-s.orientation),l=s.shape.intersection_with_segment(a,c);if(l)return n.intersection_global.setVec(NtVec2.add(NtVec2.rotate(l,s.orientation),s.position)),n.other_body=s,!0}}return!1},t}(),NtRaycastManifold=function(){this.penetration=0,this.intersection_global=new NtVec2,this.other_body=null},NtCircleCircleCollision=function(){function t(t){this.manifold=t}return t.prototype.hasCollision=function(){var t=this.manifold.A,e=this.manifold.B,i=t.shape,n=e.shape,o=NtVec2.subtract(e.position,t.position),r=i.radius+n.radius;if(r*=r,NtVec2.distanceSquared(t.position,e.position)>r)return!1;var s=NtVec2.distance(t.position,e.position);return 0!=s?(this.manifold.penetration=r-s,this.manifold.normal=NtVec2.divide(o,s),this.manifold.contact_points.push((new NtVec2).fromVec(t.position))):(this.manifold.penetration=i.radius,this.manifold.normal=new NtVec2(1,0),this.manifold.contact_points.push(NtVec2.multiply(this.manifold.normal,i.radius).add(t.position))),!0},t}(),NtCirclePolygonCollision=function(){function t(t){this.manifold=t,this.A=t.A,this.B=t.B,this.circle_shape=this.A.shape,this.poly_shape=this.B.shape}return t.prototype.hasCollision=function(){var t=this.get_edge_min_penetration();if(!t)return!1;var e=t[0];return t[1]<1e-4?(this.populate_manifold_for_circle_center_inside_poly(e),!0):this.populate_manifold_according_to_side_of_edge(t)},t.prototype.populate_manifold_according_to_side_of_edge=function(t){var e=t[0],i=t[1],n=this.poly_shape.vertices,o=n[e],r=n[(e+1)%n.length],s=NtVec2.rotate(NtVec2.subtract(this.A.position,this.B.position),-this.B.orientation),a=NtVec2.dotProduct(NtVec2.subtract(s,o),NtVec2.subtract(r,o)),c=NtVec2.dotProduct(NtVec2.subtract(s,r),NtVec2.subtract(o,r));return this.manifold.penetration=this.circle_shape.radius-i,a<=0?this.populate_manifold_for_nearest_vertex(o,s):c<=0?this.populate_manifold_for_nearest_vertex(r,s):this.populate_manifold_for_nearest_face(o,s,e)},t.prototype.get_edge_min_penetration=function(){for(var t=NtVec2.rotate(NtVec2.subtract(this.A.position,this.B.position),-this.B.orientation),e=-Number.MAX_VALUE,i=0,n=0;n<this.poly_shape.vertices.length;n++){var o=NtVec2.dotProduct(this.poly_shape.normals[n],NtVec2.subtract(t,this.poly_shape.vertices[n]));if(o>this.circle_shape.radius)return null;e<o&&(e=o,i=n)}return[i,e]},t.prototype.populate_manifold_for_circle_center_inside_poly=function(t){this.manifold.normal.setVec(NtVec2.rotate(this.poly_shape.normals[t],this.B.orientation).negate()),this.manifold.contact_points.push(NtVec2.multiply(this.manifold.normal,this.circle_shape.radius).add(this.A.position)),this.manifold.penetration=this.circle_shape.radius},t.prototype.populate_manifold_for_nearest_vertex=function(t,e){var i=this.circle_shape.radius;if(NtVec2.distanceSquared(e,t)>i*i)return!1;var n=NtVec2.rotate(NtVec2.subtract(t,e),this.B.orientation).normalize();return this.manifold.normal=n,t=NtVec2.rotate(t,this.B.orientation).add(this.B.position),this.manifold.contact_points.push(t),!0},t.prototype.populate_manifold_for_nearest_face=function(t,e,i){var n=this.poly_shape.normals[i];return!(NtVec2.dotProduct(NtVec2.subtract(e,t),n)>this.circle_shape.radius)&&(n=NtVec2.rotate(n,this.B.orientation),this.manifold.normal=n.negate(),this.manifold.contact_points.push(NtVec2.add(NtVec2.multiply(this.manifold.normal,this.circle_shape.radius),this.A.position)),!0)},t}(),NtPolygonPolygonCollision=function(){function t(t){this.manifold=t,this.A=t.A,this.B=t.B}return t.prototype.hasCollision=function(){var t=this.axis_least_penetration(this.A,this.B);if(0<=t[0])return!1;var e,i,n,o,r,s=this.axis_least_penetration(this.B,this.A);if(0<=s[0])return!1;t[0]>s[0]?(i=this.A,n=this.B,e=this.A.shape,o=t[1],r=!1):(i=this.B,n=this.A,e=this.B.shape,o=s[1],r=!0);var a=this.find_incident_face(i,n,o),c=e.vertices[o],l=e.vertices[(o+1)%e.vertices.length];c=NtVec2.add(i.position,NtVec2.rotate(c,i.orientation)),l=NtVec2.add(i.position,NtVec2.rotate(l,i.orientation));var h=NtVec2.subtract(l,c).normalize(),u=new NtVec2(h.y,-h.x),p=NtVec2.dotProduct(u,c),d=-NtVec2.dotProduct(h,c),_=NtVec2.dotProduct(h,l),f=NtVec2.negate(h);if(this.clip(f,d,a)<2)return!1;if(this.clip(h,_,a)<2)return!1;this.manifold.normal=NtVec2.multiply(u,r?-1:1);var y=this.manifold.penetration=0,v=NtVec2.dotProduct(u,a[0])-p;return v<=0&&(this.manifold.contact_points[y]=a[0],this.manifold.penetration+=-v,++y),(v=NtVec2.dotProduct(u,a[1])-p)<=0&&(this.manifold.contact_points[y]=a[1],this.manifold.penetration+=-v,++y,this.manifold.penetration/=y),!0},t.prototype.clip=function(t,e,i){var n=0,o=[i[0],i[1]],r=NtVec2.dotProduct(t,i[0])-e,s=NtVec2.dotProduct(t,i[1])-e;if(r<=0&&(o[n++]=i[0]),s<=0&&(o[n++]=i[1]),r*s<0){var a=r/(r-s);o[n]=NtVec2.add(i[0],NtVec2.multiply(NtVec2.subtract(i[1],i[0]),a)),n++}return i[0]=o[0],i[1]=o[1],n},t.prototype.find_incident_face=function(t,e,i){var n=t.shape,o=e.shape,r=n.normals[i];r=NtVec2.rotate(r,t.orientation),r=NtVec2.rotate(r,-e.orientation);for(var s=0,a=Number.MAX_VALUE,c=0;c<o.vertices.length;c++){var l=NtVec2.dotProduct(r,o.normals[c]);l<a&&(a=l,s=c)}var h=[new NtVec2,new NtVec2];return h[0]=NtVec2.add(e.position,NtVec2.rotate(o.vertices[s],e.orientation)),s=(s+1)%o.vertices.length,h[1]=NtVec2.add(e.position,NtVec2.rotate(o.vertices[s],e.orientation)),h},t.prototype.axis_least_penetration=function(t,e){for(var i=-Number.MAX_VALUE,n=-1,o=t.shape,r=e.shape,s=0;s<o.vertices.length;s++){var a=NtVec2.rotate(o.normals[s],t.orientation),c=NtVec2.rotate(a,-e.orientation),l=r.get_support_point(NtVec2.negate(c)),h=NtVec2.add(t.position,NtVec2.rotate(o.vertices[s],t.orientation)),u=NtVec2.rotate(h.subtract(e.position),-e.orientation),p=NtVec2.dotProduct(c,NtVec2.subtract(l,u));i<p&&(i=p,n=s)}return[i,n]},t}(),NtMouseJoint=function(){function t(){this.mouse_position=new NtVec2,this.point_local=new NtVec2,this.dragged_body=null}return t.prototype.resolve=function(){if(this.dragged_body){var t=NtVec2.add(NtVec2.rotate(this.point_local,this.dragged_body.orientation),this.dragged_body.position),e=(new NtVec2).fromVec(this.mouse_position);e.subtract(t),e.subtract(this.dragged_body.velocity),this.dragged_body.angular_velocity=0;var i=NtVec2.multiply(e,this.dragged_body.mass);this.dragged_body.apply_impulse(i,this.point_local)}},t.prototype.mouse_down=function(t){this.dragged_body=world.body_under_point(t),this.mouse_position.setVec(t),null!=this.dragged_body&&(this.point_local=NtVec2.rotate(NtVec2.subtract(t,this.dragged_body.position),-this.dragged_body.orientation))},t.prototype.mouse_move=function(t){this.dragged_body&&this.mouse_position.setVec(t)},t.prototype.mouse_up=function(){this.dragged_body=null},t}(),circle4=new NtBody(new NtVec2(150,140),new NtRectangleShape(5,5));circle4.material.density=.002,circle4.force.set(10,0),console.log(circle4);var circle7=new NtBody(new NtVec2(450,400),new NtCircleShape(40));circle7.material.density=.002,circle7.force.set(0,-350),console.log(circle7);var rect1=new NtBody(new NtVec2(295,170),new NtRectangleShape(.5,130));rect1.material.density=.5,rect1.make_static(),console.log(rect1);var circle5=new NtBody(new NtVec2(150,50),new NtCircleShape(40));circle5.material.density=.002,circle5.force.set(0,80),console.log(circle5);var circle6=new NtBody(new NtVec2(450,250),new NtCircleShape(40));circle6.material.density=.002,circle6.force.setVec(new NtVec2(-80,0)),console.log(circle6);var canvas=document.getElementById("myCanvas"),canvasContext=canvas.getContext("2d"),renderer=new Renderer(canvasContext,canvas.width,canvas.height),world=new NtWorld(renderer);world.add(circle4),world.add(rect1),setInterval(function(){canvasContext.clearRect(0,0,canvas.width,canvas.height),world.step(.033),renderer.draw()},33);var mouse_joint=new NtMouseJoint;world.addJoint(mouse_joint),canvas.addEventListener("mousedown",function(t){var e=new NtVec2(t.pageX-canvas.offsetLeft,t.pageY-canvas.offsetTop);mouse_joint.mouse_down(e)}),canvas.addEventListener("mousemove",function(t){var e=new NtVec2(t.pageX-canvas.offsetLeft,t.pageY-canvas.offsetTop);mouse_joint.mouse_move(e)}),canvas.addEventListener("mouseup",function(){mouse_joint.mouse_up()});