"use strict";var Rectangle=function(){function t(t){this.object=t}return t.prototype.draw=function(t){var n=this.object.position,e=this.object.width,i=this.object.height;0<this.object.collisions.size?(t.strokeStyle="rgba(247, 186, 197, 0.8)",t.fillStyle="rgba(247, 186, 197, 0.6)"):(t.strokeStyle="rgba(255, 255, 255, 0.8)",t.fillStyle="rgba(255, 255, 255, 0.5)"),t.lineWidth=2,t.beginPath(),t.moveTo(n.x-e/2,n.y-i/2),t.lineTo(n.x+e/2,n.y-i/2),t.lineTo(n.x+e/2,n.y+i/2),t.lineTo(n.x-e/2,n.y+i/2),t.lineTo(n.x-e/2,n.y-i/2),t.closePath(),t.stroke(),t.fill()},t.prototype.print=function(){console.log("Rectangle{position: "+this.object.position+", width: "+this.object.width+", "+this.object.height)},t}(),Renderer=function(){function t(t,n,e){this.canvas=t,this.renderables=[],this.width=n,this.height=e}return t.prototype.draw=function(){this.canvas.clearRect(0,0,this.width,this.height);var t=this.canvas.createLinearGradient(0,0,this.width,this.height);t.addColorStop(0,"#90C3D4"),t.addColorStop(1,"#82B0BF"),this.canvas.fillStyle=t,this.canvas.fillRect(0,0,this.width,this.height),this.draw_lines();for(var n=0,e=this.renderables;n<e.length;n++){e[n].draw(this.canvas)}},t.prototype.draw_lines=function(){this.canvas.lineWidth=.5;var t=100,n=this.width/t,e=this.height/t;this.canvas.strokeStyle="rgba(255, 255, 255, 0.3)";for(var i=0;i<e;i++)this.canvas.beginPath(),this.canvas.moveTo(0,i*t),this.canvas.lineTo(this.width,i*t),this.canvas.stroke();for(i=0;i<n;i++)this.canvas.beginPath(),this.canvas.moveTo(i*t,0),this.canvas.lineTo(i*t,this.height),this.canvas.stroke()},t.prototype.add=function(t){t instanceof NtRectangle&&this.renderables.push(new Rectangle(t))},t.prototype.remove=function(n){var t=this.renderables.findIndex(function(t){return t.object==n});-1!=t&&this.renderables.splice(t,1)},t}(),NtAABB=function(){this.min=new NtVec,this.max=new NtVec},NtBase=function(){function n(t){this.position=new NtVec2,this.velocity=new NtVec2,this.collisions=new Set,this.aabb=new NtAABB,this.restitution=1,this._mass=0,this._inverse_mass=0,this.position.fromVec(t),this.id=n.counter++}return n.prototype.step=function(){this.position.add(this.velocity)},Object.defineProperty(n.prototype,"mass",{get:function(){return this._mass},set:function(t){this._mass=t,this._inverse_mass=1/t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inverse_mass",{get:function(){return this._inverse_mass},enumerable:!0,configurable:!0}),n.counter=0,n}(),NtCollisionUtils=function(){function y(){}return y.AABBvsAABB=function(t){var n=t.A,e=t.B,i=NtVec.subtract(e.position,n.position),o=n.aabb,s=e.aabb,r=new NtVec,a=(o.max.x-o.min.x)/2,c=(s.max.x-s.min.x)/2;if(r.x=a+c-Math.abs(i.x),0<r.x){var h=(o.max.y-o.min.y)/2,l=(s.max.y-s.min.y)/2;if(r.y=h+l-Math.abs(i.y),0<r.y)return y.calculateNormal(t,r,i)}return!1},y.calculateNormal=function(t,n,e){return n.x>n.y?(e.x<0?t.normal=new NtVec(-1,0):t.normal=new NtVec(1,0),t.penetration=n.x):(e.y<0?t.normal=new NtVec(0,-1):t.normal=new NtVec(0,1),t.penetration=n.y),!0},y}(),NtManifold=function(){},__extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};return function(t,n){function e(){this.constructor=t}i(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),NtRectangle=function(o){function t(t,n,e){var i=o.call(this,t)||this;return i.width=n,i.height=e,i}return __extends(t,o),t.prototype.step=function(){o.prototype.step.call(this),this.aabb.min.set(this.position.x-this.width/2,this.position.y-this.height/2),this.aabb.max.set(this.position.x+this.width/2,this.position.y+this.height/2)},t.prototype.toString=function(){return"NtRectangle{position: "+this.position+", width: "+this.width+", height: "+this.height+"}"},t}(NtBase),NtVec=function(){function e(t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.x=t,this.y=n}return e.prototype.add=function(t){this.x+=t.x,this.y+=t.y},e.prototype.subtract=function(t){this.x-=t.x,this.y-=t.y},e.prototype.fromVec=function(t){this.x=t.x,this.y=t.y},e.prototype.set=function(t,n){this.x=t,this.y=n},e.prototype.toString=function(){return"NtVec{x: "+this.x+", y: "+this.y+"}"},e.add=function(t,n){return new e(t.x+n.x,t.y+n.y)},e.subtract=function(t,n){return new e(t.x-n.x,t.y-n.y)},e.multiply=function(t,n){return new e(t.x*n,t.y*n)},e.dotProduct=function(t,n){return t.x*n.x+t.y*n.y},e}(),NtVec2=function(){function e(t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.x=t,this.y=n}return e.prototype.add=function(t){this.x+=t.x,this.y+=t.y},e.prototype.subtract=function(t){this.x-=t.x,this.y-=t.y},e.prototype.fromVec=function(t){this.x=t.x,this.y=t.y},e.prototype.set=function(t,n){this.x=t,this.y=n},e.prototype.toString=function(){return"NtVec2{x: "+this.x+", y: "+this.y+"}"},e.add=function(t,n){return new e(t.x+n.x,t.y+n.y)},e.subtract=function(t,n){return new e(t.x-n.x,t.y-n.y)},e.multiply=function(t,n){return new e(t.x*n,t.y*n)},e.dotProduct=function(t,n){return t.x*n.x+t.y*n.y},e}(),NtWorld=function(){function t(t){this.renderer=t,this.list=[],this.collisionResolver=new NtCollisionResolver}return t.prototype.step=function(){var i=this;this.list.forEach(function(t){t.collisions.clear(),t.step()}),this.list.forEach(function(e){i.list.forEach(function(t){if(e!=t&&!e.collisions.has(t)){var n=new NtManifold(t,e);i.collisionResolver.hasCollision(n)&&(e.collisions.add(t),t.collisions.add(e),i.collisionResolver.resolve(n))}})})},t.prototype.add=function(t){this.list.push(t),this.renderer.add(t)},t.prototype.remove=function(t){var n=this.list.indexOf(t);-1!=n&&(this.list.splice(n,1),this.renderer.remove(t))},t}(),NtCollisionResolver=(NtAABB=function(){this.min=new NtVec2,this.max=new NtVec2},function(){function t(){}return t.prototype.hasCollision=function(t){var n=t.A,e=t.B;return n instanceof NtRectangle&&e instanceof NtRectangle&&NtCollisionUtils.AABBvsAABB(t)},t.prototype.resolve=function(t){var n=t.A,e=t.B,i=NtVec2.subtract(e.velocity,n.velocity),o=t.normal,s=NtVec2.dotProduct(i,o),r=-(1+Math.min(n.restitution,e.restitution))*s;r/=n.inverse_mass+e.inverse_mass;var a=NtVec2.multiply(o,r);n.velocity.subtract(NtVec2.multiply(a,n.inverse_mass)),e.velocity.add(NtVec2.multiply(a,e.inverse_mass))},t}()),phys1=(NtCollisionUtils=function(){function y(){}return y.AABBvsAABB=function(t){var n=t.A,e=t.B,i=NtVec2.subtract(e.position,n.position),o=n.aabb,s=e.aabb,r=new NtVec2,a=(o.max.x-o.min.x)/2,c=(s.max.x-s.min.x)/2;if(r.x=a+c-Math.abs(i.x),0<r.x){var h=(o.max.y-o.min.y)/2,l=(s.max.y-s.min.y)/2;if(r.y=h+l-Math.abs(i.y),0<r.y)return y.calculateNormal(t,r,i),!0}return!1},y.calculateNormal=function(t,n,e){n.x>n.y?(t.normal=new NtVec2(0,Math.sign(e.x)),t.penetration=n.x):(t.normal=new NtVec2(Math.sign(e.y),0),t.penetration=n.y)},y}(),NtManifold=function(t,n){this.penetration=0,this.normal=new NtVec2,this.A=t,this.B=n},new NtRectangle(new NtVec2(370,160),50,40));phys1.mass=20,phys1.velocity.set(-1.5,0),console.log(phys1);var phys2=new NtRectangle(new NtVec2(10,160),50,40);phys2.mass=20,phys2.velocity.set(1.5,0),console.log(phys2);var phys3=new NtRectangle(new NtVec2(200,190),150,120);phys3.mass=20,console.log(phys3);var phys4=new NtRectangle(new NtVec2(210,-60),50,40);phys4.mass=20,phys4.velocity.set(0,1.5),console.log(phys4);var phys5=new NtRectangle(new NtVec2(210,370),50,40);phys5.mass=20,phys5.velocity.set(0,-1.5),console.log(phys5);var canvas=document.getElementById("myCanvas"),canvasContext=canvas.getContext("2d"),renderer=new Renderer(canvasContext,canvas.width,canvas.height),world=new NtWorld(renderer);world.add(phys1),world.add(phys2),world.add(phys3),world.add(phys4),world.add(phys5),setInterval(function(){world.step(),renderer.draw()},33);